---
- name: Crear o actualizar usuario en MikroTik (AWX)
  hosts: all
  gather_facts: no

  vars:
    mt_user: "{{ mt_user }}"
    mt_pass: "{{ mt_pass }}"
    mt_group: "{{ mt_group | default('full') }}"

  tasks:
    - name: Crear o actualizar usuario (si existe, actualiza pass y group)
      ansible.builtin.raw: >
        :if ([:len [/user find name="{{ mt_user }}"]] = 0) do={
          /user add name="{{ mt_user }}" password="{{ mt_pass }}" group="{{ mt_group }}";
          :put ("OK_USER_CREATED {{ mt_user }}");
        } else={
          /user set [find name="{{ mt_user }}"] password="{{ mt_pass }}" group="{{ mt_group }}";
          :put ("OK_USER_UPDATED {{ mt_user }}");
        };
        /quit
      register: out_user

    - name: Mostrar resultado
      ansible.builtin.debug:
        var: out_user.stdout
