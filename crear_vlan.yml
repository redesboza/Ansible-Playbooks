---
- name: Crear VLAN en Cisco SG350 usando SSH puro
  hosts: all
  gather_facts: no

  vars:
    ssh_port: 11110
    vlan_id: 1200
    vlan_name: "Prueba1"

  tasks:
    - name: Crear VLAN usando SSH y comandos encadenados
      ansible.builtin.shell: |
        ssh -p {{ ssh_port }} -o StrictHostKeyChecking=no {{ ansible_user }}@{{ inventory_hostname }} "/bin/bash -c '
        echo enable;
        echo configure terminal;
        echo interface vlan {{ vlan_id }};
        echo name {{ vlan_name }};
        echo exit;
        echo do write memory;
        echo exit
        '"
      args:
        executable: /bin/bash
      register: resultado_vlan

    - name: Mostrar salida
      ansible.builtin.debug:
        var: resultado_vlan.stdout_lines
